<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | WildGear</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../css/cart-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="announcement-bar">
            <p>Summer Adventure Sale: Up to 40% Off Select Gear. <a href="summer-sale.html" class="btn-small">Shop Now</a></p>
            <div class="countdown" id="countdown">
                <span class="time-unit">
                    <span id="days">00</span>d
                </span>
                <span class="time-unit">
                    <span id="hours">00</span>h
                </span>
                <span class="time-unit">
                    <span id="minutes">00</span>m
                </span>
                <span class="time-unit">
                    <span id="seconds">00</span>s
                </span>
            </div>
        </div>
        <nav>
            <div class="logo">
                <a href="../index.html"><img src="../img/logo.svg" alt="WildGear Logo"></a>
            </div>
            <ul class="nav-links">
                <li><a href="summer-sale.html">Summer Sale</a></li>
                <li><a href="products.html">Products</a></li>
                <li><a href="#">Activities</a></li>
                <li><a href="#">Adventures</a></li>
                <li><a href="#">Guides</a></li>
                <li><a href="#">Support</a></li>
            </ul>
            <div class="nav-actions">
                <a href="#" class="icon-link"><i class="fas fa-search"></i></a>
                <a href="#" class="icon-link"><i class="fas fa-user"></i></a>
                <a href="cart.html" class="icon-link active"><i class="fas fa-shopping-cart"></i><span class="cart-count">3</span></a>
            </div>
            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </nav>
    </header>

    <section class="page-header">
        <div class="container">
            <h1>Shopping Cart</h1>
            <div class="breadcrumb">
                <a href="../index.html">Home</a> / <span>Cart</span>
            </div>
        </div>
    </section>

    <section class="cart-section">
        <div class="container">
            <div class="cart-container">
                <div class="cart-items">
                    <h2>Your Items (<span id="cart-item-count">0</span>)</h2>
                    <!-- <div class="cart-headers"> -->
                        <!-- <span class="header-product">Product</span>
                        <span class="header-price">Price</span>
                        <span class="header-quantity">Quantity</span>
                        <span class="header-total">Total</span> -->
                    <!-- </div> -->

                    <div id="cart-items-container">
                        <!-- 购物车项目将通过JavaScript动态生成 -->
                    </div>

                    <!-- <div class="cart-actions">
                        <button class="continue-shopping"><i class="fas fa-arrow-left"></i> Continue Shopping</button>
                        <button class="update-cart">Update Cart</button>
                    </div> -->
                </div>

                <div class="cart-summary">
                    <h2>Order Summary</h2>
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping</span>
                        <span id="shipping">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax</span>
                        <span id="tax">$0.00</span>
                    </div>

                    <div class="promo-code">
                        <h3>Promo Code</h3>
                        <div class="promo-input">
                            <input type="text" placeholder="Enter promo code">
                            <button>Apply</button>
                        </div>
                    </div>

                    <div class="summary-total">
                        <span>Total</span>
                        <span id="total">$0.00</span>
                    </div>

                    <button class="checkout-btn">Proceed to Checkout</button>

                    <div class="payment-methods-icons">
                        <i class="fab fa-cc-visa"></i>
                        <i class="fab fa-cc-mastercard"></i>
                        <i class="fab fa-cc-amex"></i>
                        <i class="fab fa-cc-paypal"></i>
                        <i class="fab fa-cc-discover"></i>
                    </div>

                    <div class="secure-checkout">
                        <i class="fas fa-lock"></i> Secure Checkout
                    </div>
                </div>
            </div>

            <div class="suggested-products">
                <h2>You Might Also Like</h2>
                <div class="product-grid" id="suggested-products">
                    <!-- 推荐产品将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </section>

    <section class="newsletter">
        <h3>Be the first to receive our latest news and exclusive deals!</h3>
        <div class="newsletter-form">
            <input type="email" placeholder="Email Address">
            <button type="submit">Subscribe</button>
        </div>
        <div class="social-links">
            <p>Follow Us</p>
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
                <a href="#"><i class="fab fa-pinterest"></i></a>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-columns">
            <div class="footer-column">
                <h4>Products</h4>
                <ul>
                    <li><a href="summer-sale.html">Sale</a></li>
                    <li><a href="#">New Releases</a></li>
                    <li><a href="#">Camping Gear</a></li>
                    <li><a href="#">Hiking Equipment</a></li>
                    <li><a href="#">Climbing Tools</a></li>
                    <li><a href="#">Fishing Gear</a></li>
                    <li><a href="#">Water Sports</a></li>
                    <li><a href="#">Apparel</a></li>
                    <li><a href="#">Footwear</a></li>
                    <li><a href="#">Accessories</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Activities</h4>
                <ul>
                    <li><a href="#">Camping</a></li>
                    <li><a href="#">Hiking</a></li>
                    <li><a href="#">Climbing</a></li>
                    <li><a href="#">Fishing</a></li>
                    <li><a href="#">Kayaking</a></li>
                    <li><a href="#">Mountaineering</a></li>
                    <li><a href="#">Trail Running</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Adventures</h4>
                <ul>
                    <li><a href="#">Weekend Trips</a></li>
                    <li><a href="#">Expedition Planning</a></li>
                    <li><a href="#">Guided Tours</a></li>
                    <li><a href="#">National Parks</a></li>
                    <li><a href="#">International Treks</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Learn</h4>
                <ul>
                    <li><a href="#">Outdoor Skills</a></li>
                    <li><a href="#">Survival Techniques</a></li>
                    <li><a href="#">Gear Guides</a></li>
                    <li><a href="#">Trail Maps</a></li>
                    <li><a href="#">Weather Preparation</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Support</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Shipping Info</a></li>
                    <li><a href="#">Returns & Warranty</a></li>
                    <li><a href="#">Size Charts</a></li>
                    <li><a href="#">Care Instructions</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="payment-methods">
                <img src="https://www.paypalobjects.com/webstatic/mktg/Logo/pp-logo-100px.png" alt="Payment Methods">
            </div>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Accessibility</a>
                <a href="#">Sitemap</a>
            </div>
            <div class="copyright">
                <p>&copy; 2025 WildGear Outdoor Equipment. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div class="chat-widget">
        <div class="chat-icon">
            <i class="fas fa-comments"></i>
        </div>
        <div class="chat-text">Contact support</div>
    </div>

    <!-- 弹窗联系我们 -->
    <div id="custom-modal" class="custom-modal">
        <div class="custom-modal-content">
          <h2>Need help?</h2>
          <p>🛎 In order to better confirm your order details and ensure timely shipment, please contact our customer service to complete the order process.</p>
          <div class="modal-buttons">
            <button id="contact-support">Contact Customer</button>
            <button id="close-modal">Cancel</button>
          </div>
        </div>
      </div>

    <script src="../js/cart-manager.js"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/summer-sale.js"></script>
    <script src="../script.js"></script>
    
    <!-- 添加一个简单的脚本来从localStorage获取购物车数据 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 检查CartManager是否存在
            if (typeof CartManager === 'undefined') {
                console.warn('CartManager未定义，创建基本购物车功能');
                
                // 创建基本的购物车功能
                window.CartManager = {
                    getCartItems() {
                        const cartItems = localStorage.getItem('cart');
                        console.log('从localStorage获取的原始购物车数据:', cartItems);
                        try {
                            const parsedItems = cartItems ? JSON.parse(cartItems) : [];
                            console.log('解析后的购物车数据:', parsedItems);
                            return parsedItems;
                        } catch (e) {
                            console.error('解析购物车数据时出错:', e);
                            return [];
                        }
                    },
                    
                    saveCartItems(items) {
                        if (!Array.isArray(items)) {
                            console.warn('items不是数组:', items);
                            items = [];
                        }
                        console.log('保存到localStorage的购物车数据:', items);
                        localStorage.setItem('cart', JSON.stringify(items));
                        this.updateCartUI();
                    },
                    
                    updateCartUI() {
                        const cartItems = this.getCartItems();
                        const cartItemsContainer = document.getElementById('cart-items-container');
                        const cartItemCount = document.getElementById('cart-item-count');
                        
                        if (!cartItemsContainer) {
                            console.warn('未找到购物车容器');
                            return;
                        }
                        
                        // 确保cartItems是数组
                        if (!Array.isArray(cartItems)) {
                            console.error('cartItems不是数组:', cartItems);
                            cartItemsContainer.innerHTML = '<div class="empty-cart">Your shopping cart is empty</div>';
                            return;
                        }
                        
                        // 更新商品数量显示
                        if (cartItemCount) {
                            cartItemCount.textContent = cartItems.length.toString();
                        }
                        
                        if (cartItems.length === 0) {
                            cartItemsContainer.innerHTML = '<div class="empty-cart">Your shopping cart is empty</div>';
                            return;
                        }
                        
                        // 更新购物车项目显示
                        let cartHTML = '';
                        
                        cartItems.forEach(item => {
                            const price = parseFloat(item.price || 0);
                            const total = price * (parseInt(item.quantity || 1));
                            
                            // 获取产品图片
                            let imagePath = item.image || 'https://via.placeholder.com/150x150?text=No+Image';
                            console.log("获取到的图片地址：" + imagePath);
                            
                            // 检查图片路径是否有效
                            if (!imagePath || imagePath === 'undefined' || imagePath === 'null') {
                                imagePath = 'https://via.placeholder.com/150x150?text=No+Image';
                            }
                            
                            cartHTML += `
                                <div class="cart-item" data-id="${item.id}">
                                    <div class="item-image">
                                        <img src="${imagePath}" alt="${item.name || 'Product'}" 
                                             onerror="this.src='https://via.placeholder.com/150x150?text=No+Image'">
                                    </div>
                                    <div class="item-details">
                                        <h3>${item.name || 'Unnamed Product'}</h3>
                                        <p class="item-attributes">
                                            ${item.color ? `Color: ${item.color}` : ''}
                                            ${item.size ? ` | Size: ${item.size}` : ''}
                                        </p>
                                        <button class="remove-item"><i class="fas fa-trash-alt"></i> Remove</button>
                                        <button class="save-for-later"><i class="far fa-heart"></i> Save for Later</button>
                                    </div>
                                    <div class="item-price">$${price.toFixed(2)}</div>
                                    <div class="item-quantity">
                                        <button class="quantity-btn decrease">-</button>
                                        <input type="number" value="${item.quantity || 1}" min="1" max="10">
                                        <button class="quantity-btn increase">+</button>
                                    </div>
                                    <div class="item-total">$${total.toFixed(2)}</div>
                                </div>
                            `;
                        });
                        
                        cartItemsContainer.innerHTML = cartHTML;
                        
                        // 添加事件监听器
                        this.addEventListeners();
                        
                        // 更新购物车摘要
                        this.updateCartSummary();
                    },
                    
                    addEventListeners() {
                        // 移除商品按钮
                        document.querySelectorAll('.remove-item').forEach(button => {
                            button.addEventListener('click', (e) => {
                                const cartItem = e.target.closest('.cart-item');
                                const itemId = cartItem.dataset.id;
                                this.removeFromCart(itemId);
                            });
                        });
                        
                        // 数量按钮
                        document.querySelectorAll('.quantity-btn').forEach(button => {
                            button.addEventListener('click', (e) => {
                                const cartItem = e.target.closest('.cart-item');
                                const itemId = cartItem.dataset.id;
                                const isIncrease = e.target.classList.contains('increase');
                                this.updateQuantity(itemId, isIncrease ? 1 : -1);
                            });
                        });
                        
                        // 数量输入框
                        document.querySelectorAll('.item-quantity input').forEach(input => {
                            input.addEventListener('change', (e) => {
                                const cartItem = e.target.closest('.cart-item');
                                const itemId = cartItem.dataset.id;
                                const newValue = parseInt(e.target.value);
                                if (newValue > 0 && newValue <= 10) {
                                    this.updateQuantityInput(itemId, newValue);
                                } else {
                                    e.target.value = 1;
                                }
                            });
                        });
                    },
                    
                    removeFromCart(itemId) {
                        const cartItems = this.getCartItems();
                        const updatedItems = cartItems.filter(item => item.id !== itemId);
                        this.saveCartItems(updatedItems);
                        this.showNotification('商品已从购物车中移除');
                    },
                    
                    updateQuantity(itemId, change) {
                        const cartItems = this.getCartItems();
                        const item = cartItems.find(item => item.id === itemId);
                        if (item) {
                            const newQuantity = item.quantity + change;
                            if (newQuantity > 0 && newQuantity <= 10) {
                                item.quantity = newQuantity;
                                this.saveCartItems(cartItems);
                            }
                        }
                    },
                    
                    updateQuantityInput(itemId, value) {
                        const cartItems = this.getCartItems();
                        const item = cartItems.find(item => item.id === itemId);
                        if (item) {
                            item.quantity = value;
                            this.saveCartItems(cartItems);
                        }
                    },
                    
                    updateCartSummary() {
                        const cartItems = this.getCartItems();
                        const subtotal = this.calculateSubtotal(cartItems);
                        const shipping = this.calculateShipping(subtotal);
                        const tax = this.calculateTax(subtotal);
                        const total = subtotal + shipping + tax;
                        
                        // 更新摘要元素
                        const subtotalElement = document.getElementById('subtotal');
                        const shippingElement = document.getElementById('shipping');
                        const taxElement = document.getElementById('tax');
                        const totalElement = document.getElementById('total');
                        
                        if (subtotalElement) subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
                        if (shippingElement) shippingElement.textContent = `$${shipping.toFixed(2)}`;
                        if (taxElement) taxElement.textContent = `$${tax.toFixed(2)}`;
                        if (totalElement) totalElement.textContent = `$${total.toFixed(2)}`;
                    },
                    
                    calculateSubtotal(cartItems) {
                        return cartItems.reduce((total, item) => {
                            return total + (parseFloat(item.price || 0) * (parseInt(item.quantity || 1)));
                        }, 0);
                    },
                    
                    calculateShipping(subtotal) {
                        return subtotal > 100 ? 0 : 10; // 超过$100免运费
                    },
                    
                    calculateTax(subtotal) {
                        return subtotal * 0.08; // 8%税费
                    },
                    
                    showNotification(message) {
                        const notification = document.createElement('div');
                        notification.className = 'notification';
                        notification.textContent = message;
                        document.body.appendChild(notification);
                        
                        setTimeout(() => {
                            notification.classList.add('show');
                        }, 100);
                        
                        setTimeout(() => {
                            notification.classList.remove('show');
                            setTimeout(() => {
                                notification.remove();
                            }, 300);
                        }, 3000);
                    },
                    
                    init() {
                        this.updateCartUI();
                    }
                };
            }
            
            // 初始化购物车
            CartManager.init();
            
            // 添加结账按钮事件监听器
            const checkoutBtn = document.querySelector('.checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function() {
                    document.getElementById('custom-modal').style.display = 'flex';
                });
            }
            
            // 添加关闭模态框事件监听器
            const closeModalBtn = document.getElementById('close-modal');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', function() {
                    document.getElementById('custom-modal').style.display = 'none';
                });
            }
            
            // 添加联系客服按钮事件监听器
            const contactSupportBtn = document.getElementById('contact-support');
            if (contactSupportBtn) {
                contactSupportBtn.addEventListener('click', function() {
                    window.location.href = 'https://wa.me/8613326425565?text=Hello,%20I%20want%20to%20place%20an%20order';
                });
            }
        });
    </script>
</body>
</html>
